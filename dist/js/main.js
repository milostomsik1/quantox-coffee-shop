function getLatLng(e){userLatitude=e.coords.latitude,userLongitude=e.coords.longitude,console.log(userLatitude+" "+userLongitude),searchForCoffeeShops(userLatitude,userLongitude),initMap(userLatitude,userLongitude),createUserMarker(userLatitude,userLongitude)}function getError(e){switch(e.code){case e.PERMISSION_DENIED:alert("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:alert("Location information is unavailable.");break;case e.TIMEOUT:alert("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:alert("An unknown error occurred.")}}function searchForCoffeeShops(e,t){var o="https://api.foursquare.com/v2/venues/search?client_id="+CLIENT_ID+"&client_secret="+CLIENT_SECRET+"&v=20130815&ll="+e+","+t+"&intent=browse&radius=1500&limit=10&query=coffee",n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText).response.venues;console.log(e),e.forEach(function(t,o){getCoffeeShopInfo(e[o].id,e[o].location.distance)})}},n.open("GET",o,!0),n.send()}function getCoffeeShopInfo(e,t){var o=new XMLHttpRequest,n="https://api.foursquare.com/v2/venues/"+e+"?client_id="+CLIENT_ID+"&client_secret="+CLIENT_SECRET+"&v=20130815";o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText).response.venue;console.log(e);var o=e.photos.groups[0].items[0].prefix+"original"+e.photos.groups[0].items[0].suffix,n={id:e.id,name:e.name,distance:t,isOpen:function(){return e.hasOwnProperty("hours")?e.hours.isOpen:"No hours defined."}(),picture:o,price:function(){return e.hasOwnProperty("price")?e.price.tier:9}(),lat:e.location.lat,lng:e.location.lng};coffeeShops.push(n),sortByClosest(),createShopMarker(n)}},o.open("GET",n,!0),o.send()}function sortByClosest(){coffeeShops.sort(function(e,t){return e.distance-t.distance})}function sortByCheapest(){coffeeShops.sort(function(e,t){return e.price-t.price})}function initMap(e,t){map=new google.maps.Map(document.getElementById("google-map"),{zoom:15,streetViewControl:!1,mapTypeControl:!1,center:{lat:e,lng:t}})}function createShopMarker(e){var t=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:map,icon:"./assets/coffee-icon.png",title:e.name}),o=new google.maps.InfoWindow({content:"<h2>"+e.name+"("+e.distance+"m)</h2>"});t.addListener("click",function(){o.open(map,t)}),map.addListener("click",function(){o.close()})}function createUserMarker(e,t){new google.maps.Marker({position:{lat:e,lng:t},map:map,icon:"./assets/user-icon.png"})}var CLIENT_ID="SRSTKKDUOVCGTIYWEDEXYFGPPCFWSE25KA3PIJ3MLR0UFRWK",CLIENT_SECRET="CMTPSXLN4WZL0W2GT2GIYADXUKXFPAUKXDBKFYFXQHASS4KV",userLatitude,userLongitude,map,uluru,coffeeShops=[];!function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(getLatLng,getError,{enableHighAccuracy:!0,timeout:5e3}):alert("Geolocation is not supported.")}();